<!-- views/createDish.ejs -->
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>T·∫°o m√≥n ƒÉn m·ªõi</title>
  <link rel="stylesheet" href="/css/createDish.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
</head>
<div>
  <header class="menu-header">
    <button class="btn-return fas fa-chevron-left fa-lg" onclick="window.location.href='/admin/menu'">
    </button>
    <h1>T·∫°o m√≥n ƒÉn m·ªõi</h1>
  </header>
<div class="form-wrapper">
  <div class="form-container">
    <form id="createDishForm" onsubmit="handleFormSubmit(event)">
      <div class="form-group">
        <label for="foodName">T√™n m√≥n ƒÉn</label>
        <input type="text" id="foodName" name="foodName" placeholder="Nh·∫≠p t√™n m√≥n ƒÉn" required>
      </div>
    
      <div class="form-group">
        <label for="description">M√¥ t·∫£</label>
        <textarea id="description" name="description" rows="3" placeholder="M√¥ t·∫£ chi ti·∫øt m√≥n ƒÉn" required></textarea>
      </div>
    
      <div class="form-group">
        <label for="price">Gi√°</label>
        <input type="number" id="price" name="price" placeholder="Nh·∫≠p gi√°" required>
      </div>
    
      <div class="form-group">
        <label for="imageUrl">ƒê∆∞·ªùng d·∫´n ·∫£nh</label>
        <input type="text" id="imageUrl" name="imageUrl" placeholder="URL ·∫£nh m√≥n ƒÉn" required>
      </div>
    
      <button type="submit" class="submit-btn">T·∫°o m√≥n ƒÉn</button>
    </form>
  </div>
</div>
<script>
  function handleFormSubmit(event) {
    event.preventDefault(); // NgƒÉn ch·∫∑n form g·ª≠i ƒëi theo c√°ch th√¥ng th∆∞·ªùng

    const form = document.getElementById("createDishForm");
    const formData = new FormData(form);

    fetch("/admin/menu", {
      method: "POST",
      body: new URLSearchParams([...formData]), // Chuy·ªÉn ƒë·ªïi FormData th√†nh URLSearchParams
      headers: {
        "Content-Type": "application/x-www-form-urlencoded"
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        Swal.fire({
          title: "Ho√†n t·∫•t!",
          text: "üéâ T·∫°o m√≥n ƒÉn th√†nh c√¥ng",
          icon: "success",
          background: "#ffffff",
          color: "#333",
          confirmButtonColor: "#ff7f50",
          confirmButtonText: "OK",
          padding: "20px",
          showClass: {
            popup: "animate__animated animate__zoomIn"
          },
          hideClass: {
            popup: "animate__animated animate__fadeOutDown"
          }
        }).then(() => {
          window.location.href = "/admin/menu"; // Chuy·ªÉn v·ªÅ danh s√°ch m√≥n ƒÉn sau khi user b·∫•m OK
        });
      } else {
        Swal.fire({
          title: "L·ªói!",
          text: data.message,
          icon: "error",
          confirmButtonText: "Th·ª≠ l·∫°i",
        });
      }
    })
    .catch(error => {
      Swal.fire({
        title: "L·ªói!",
        text: "C√≥ l·ªói x·∫£y ra khi g·ª≠i d·ªØ li·ªáu.",
        icon: "error",
        confirmButtonText: "Th·ª≠ l·∫°i",
      });
    });
  }
</script>
</body>
</html>
